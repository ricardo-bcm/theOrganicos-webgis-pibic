function bindPopup(feature,layer){var props=feature.properties,description="",icon=null;if(feature.layer=layer,props)switch(description="<div><strong>"+props.nome+"</strong></div>",layer.bindPopup(description),layer.on({mouseover:function(e){icon=getSelectedIconByType(layer.feature.properties.current_tipo),layer.setIcon(icon)},mouseout:function(e){icon=getIconByType(layer.feature.properties.current_tipo),layer.setIcon(icon)}}),props.current_tipo){case"Comercio":comercioLayer.addLayer(layer);break;case"Feira":feirasLayer.addLayer(layer);break;case"Produtor":produtoresLayer.addLayer(layer)}}function sycronizeListMarkers(){var linePoint="",markerNames=[];document.getElementById("list-markers").innerHTML="",markersCluster.eachLayer(function(layer){markerNames.push(layer.feature.properties.nome)}),markerNames.sort();for(var markerName,i=0;markerName=markerNames[i];i++)linePoint+='<li class="list-group-item list-group-item-action">',linePoint+=markerName,linePoint+="</li>";$("#list-markers").append(linePoint)}function updateEventsOnMarkers(){var nome=null;$("#list-markers li").click(function(){moveToPoint(nome=$(this).text())}),$("#list-markers li").hover(function(){nome=$(this).text(),markersCluster.eachLayer(function(layer){layer.feature.properties.nome===nome&&(icon=getSelectedIconByType(layer.feature.properties.current_tipo),layer.setIcon(icon))})},function(){markersCluster.eachLayer(function(layer){layer.feature.properties.nome===nome&&(icon=getIconByType(layer.feature.properties.current_tipo),layer.setIcon(icon))})})}function getIconByType(tipo){var icon=null;switch(tipo){case"Comercio":icon=comercioMarkerIcon;break;case"Produtor":icon=produtorMarkerIcon;break;case"Feira":icon=feiraMarkerIcon}return icon}function getSelectedIconByType(tipo){var icon=null;switch(tipo){case"Comercio":icon=comercioMarkerIconSelected;break;case"Produtor":icon=produtorMarkerIconSelected;break;case"Feira":icon=feiraMarkerIconSelected}return icon}function moveToPoint(name){var latlng,controle=0;$.each(jsonData.features,function(index,element){element.properties.nome==name&&(latlng=L.latLng(element.geometry.coordinates[1],element.geometry.coordinates[0]),map.flyTo(latlng,14),map.on("zoomend",function(e){0==controle&&openPopUp(name),controle=1}))})}function openPopUp(name){var desc="";markersCluster.eachLayer(function(layer){layer.feature.properties.nome==name&&(desc="<div><strong>"+name+"</strong><br/><br/></div>",layer.bindPopup(desc).openPopup())})}var jsonData,mapboxUrl="https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",accessToken="pk.eyJ1IjoicmljYXJkb2JjbSIsImEiOiJjajlrMTJkejQxaTUyMzNwZ3cxcnM3MDU2In0.pr0XFTVGiylyl6Sth57t9g",attrib='<a href="http://openstreetmap.org">OpenStreetMap</a> | <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a> | <a href="http://mapbox.com">Mapbox</a>',streetsLayer=new L.TileLayer(mapboxUrl,{attribution:attrib,id:"mapbox.streets",accessToken:accessToken,label:"Estradas"}),satelliteStreetLayer=new L.TileLayer(mapboxUrl,{attribution:attrib,id:"mapbox.streets-satellite",accessToken:accessToken,label:"Sat√©lite"}),map=L.map("map",{center:[-5.1026,-42.8082],zoom:11,minZoom:11,maxZoom:18,zoomControl:!1,closePopupOnClick:!0,attributionControl:!0});map.on("contextmenu",function(e){e.preventDefault()}),L.Control.zoomHome().addTo(map);var streetsMinimapLayer=new L.TileLayer(mapboxUrl,{attribution:attrib,id:"mapbox.streets",minZoom:7,maxZoom:13,accessToken:accessToken}),miniMapOptions={position:"topright",toggleDisplay:!0,width:120,height:120,strings:{hideText:"Esconder minimapa",showText:"Exibir minimapa"}};new L.Control.MiniMap(streetsMinimapLayer,miniMapOptions).addTo(map);var basemapsOptions={basemaps:[streetsLayer,satelliteStreetLayer],tileX:0,tileY:0,tileZ:1};L.control.basemaps(basemapsOptions).addTo(map);var latLngOptions={separator:" [] ",emptyString:"Latitude [] Longitude"};L.control.mousePosition(latLngOptions).addTo(map);var scaleOptions={metric:!0,imperial:!1};L.control.scale(scaleOptions).addTo(map);var northWest=L.latLng(-4.904886794837085,-43.18674087524414),southEast=L.latLng(-5.332669664718695,-42.37615585327149),bounds=L.latLngBounds(northWest,southEast);map.setMaxBounds(bounds),produtoresLayerToControl=L.featureGroup(),feirasLayerToControl=L.featureGroup(),comercioLayerToControl=L.featureGroup(),produtoresLayer=L.layerGroup(),feirasLayer=L.layerGroup(),comercioLayer=L.layerGroup(),MarkerIcon=L.Icon.extend({options:{shadowUrl:"assets/img/shadow.png",iconSize:[84,71],iconAnchor:[29,63],popupAnchor:[3,-61]}}),comercioMarkerIcon=new MarkerIcon({iconUrl:"assets/img/comercio-marker.png"}),feiraMarkerIcon=new MarkerIcon({iconUrl:"assets/img/feira-marker.png"}),produtorMarkerIcon=new MarkerIcon({iconUrl:"assets/img/produtor-marker.png"}),comercioMarkerIconSelected=new MarkerIcon({iconUrl:"assets/img/comercio-marker-selected.png"}),feiraMarkerIconSelected=new MarkerIcon({iconUrl:"assets/img/feira-marker-selected.png"}),produtorMarkerIconSelected=new MarkerIcon({iconUrl:"assets/img/produtor-marker-selected.png"}),comerciosTotal=0,feirasTotal=0,produtoresTotal=0,$.getJSON("data.geojson",function(data){jsonData=data;L.geoJson(data,{pointToLayer:function(feature,latlng){switch(feature.properties.current_tipo){case"Comercio":marker=L.marker(latlng,{icon:comercioMarkerIcon,title:feature.properties.nome}),comerciosTotal+=1;break;case"Produtor":marker=L.marker(latlng,{icon:produtorMarkerIcon,title:feature.properties.nome}),produtoresTotal+=1;break;case"Feira":marker=L.marker(latlng,{icon:feiraMarkerIcon,title:feature.properties.nome}),feirasTotal+=1}return marker},onEachFeature:bindPopup});document.getElementById("totalProdutores").innerHTML="("+produtoresTotal+")",document.getElementById("totalComercios").innerHTML="("+comerciosTotal+")",document.getElementById("totalFeiras").innerHTML="("+feirasTotal+")",produtoresLayerToControl.addTo(map),feirasLayerToControl.addTo(map),comercioLayerToControl.addTo(map),markersCluster.addTo(map)});var markersCluster=L.markerClusterGroup({disableClusteringAtZoom:13,showCoverageOnHover:!0,spiderfyOnMaxZoom:!1});map.on("layeradd ",function(e){e.layer===comercioLayerToControl&&markersCluster.addLayer(comercioLayer),e.layer===feirasLayerToControl&&markersCluster.addLayer(feirasLayer),e.layer===produtoresLayerToControl&&markersCluster.addLayer(produtoresLayer),sycronizeListMarkers(),updateEventsOnMarkers()}),map.on("layerremove",function(e){e.layer===comercioLayerToControl&&markersCluster.removeLayer(comercioLayer),e.layer===feirasLayerToControl&&markersCluster.removeLayer(feirasLayer),e.layer===produtoresLayerToControl&&markersCluster.removeLayer(produtoresLayer),sycronizeListMarkers(),updateEventsOnMarkers()}),$("#switch-produtor").on("change",function(e){$(this).is(":checked")&&map.addLayer(produtoresLayerToControl),$(this).is(":not(:checked)")&&map.removeLayer(produtoresLayerToControl)}),$("#switch-comercio").on("change",function(e){$(this).is(":checked")&&map.addLayer(comercioLayerToControl),$(this).is(":not(:checked)")&&map.removeLayer(comercioLayerToControl)}),$("#switch-feira").on("change",function(e){$(this).is(":checked")&&map.addLayer(feirasLayerToControl),$(this).is(":not(:checked)")&&map.removeLayer(feirasLayerToControl)}),$("#search-input").keyup(function(){var searchField=$("#search-input").val(),regex=new RegExp(searchField,"i"),count=0;document.getElementById("search-results").innerHTML="",$.each(jsonData.features,function(index,element){if(-1!=element.properties.nome.search(regex)&&searchField&&count<5){var listSearch="";listSearch+='<li class="list-group-item link-class">',listSearch+=element.properties.nome,listSearch+="</li>",document.getElementById("search-results").innerHTML+=listSearch,count++}})}),$("#search-results").on("click","li",function(){var click_txt=$(this).text().split("|"),inputValue=$.trim(click_txt[0]);$("#search-input").val(inputValue),moveToPoint(inputValue),document.getElementById("search-results").innerHTML=""});
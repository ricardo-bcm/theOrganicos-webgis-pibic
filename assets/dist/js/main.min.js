"use strict";var produtoresLayerToControl=L.featureGroup(),feirasLayerToControl=L.featureGroup(),comercioLayerToControl=L.featureGroup(),produtoresLayer=L.layerGroup(),feirasLayer=L.layerGroup(),comercioLayer=L.layerGroup(),MarkerIcon=L.Icon.extend({options:{shadowUrl:"assets/images/shadow.png",iconSize:[54,71],iconAnchor:[29,63],popupAnchor:[-2,-61]}}),comerciosTotal=0,feirasTotal=0,produtoresTotal=0,comercioMarker=new MarkerIcon({iconUrl:"assets/images/comercio-marker.png"}),feiraMarker=new MarkerIcon({iconUrl:"assets/images/feira-marker.png"}),produtorMarker=new MarkerIcon({iconUrl:"assets/images/produtor-marker.png"}),comercioMarkerSelected=new MarkerIcon({iconUrl:"assets/images/comercio-marker-selected.png"}),feiraMarkerSelected=new MarkerIcon({iconUrl:"assets/images/feira-marker-selected.png"}),produtorMarkerSelected=new MarkerIcon({iconUrl:"assets/images/produtor-marker-selected.png"}),iconMarkers={Comercio:comercioMarker,Feira:feiraMarker,Produtor:produtorMarker,ComercioSelected:comercioMarkerSelected,FeiraSelected:feiraMarkerSelected,ProdutorSelected:produtorMarkerSelected},mapboxUrl="https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",accessToken="pk.eyJ1IjoicmljYXJkb2JjbSIsImEiOiJjajlrMTJkejQxaTUyMzNwZ3cxcnM3MDU2In0.pr0XFTVGiylyl6Sth57t9g",attrib='<a href="http://openstreetmap.org">OpenStreetMap</a> | <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a> | <a href="http://mapbox.com">Mapbox</a>',streetsLayer=new L.TileLayer(mapboxUrl,{attribution:attrib,id:"mapbox.streets",accessToken:accessToken,label:"Estradas"}),satelliteStreetLayer=new L.TileLayer(mapboxUrl,{attribution:attrib,id:"mapbox.streets-satellite",accessToken:accessToken,label:"Sat√©lite"}),map=L.map("map",{center:[-5.1026,-42.8082],zoom:11,minZoom:11,maxZoom:18,zoomControl:!1,closePopupOnClick:!0,attributionControl:!0});map.on("contextmenu",function(e){return e}),L.Control.zoomHome().addTo(map);var streetsMinimapLayer=new L.TileLayer(mapboxUrl,{attribution:attrib,id:"mapbox.streets",minZoom:7,maxZoom:13,accessToken:accessToken}),miniMapOptions={position:"topright",toggleDisplay:!0,width:120,height:120,strings:{hideText:"Esconder minimapa",showText:"Exibir minimapa"}};new L.Control.MiniMap(streetsMinimapLayer,miniMapOptions).addTo(map);var basemapsOptions={basemaps:[streetsLayer,satelliteStreetLayer],tileX:0,tileY:0,tileZ:1};L.control.basemaps(basemapsOptions).addTo(map);var latLngOptions={separator:" [] ",emptyString:"Latitude [] Longitude"};L.control.mousePosition(latLngOptions).addTo(map);var scaleOptions={metric:!0,imperial:!1};L.control.scale(scaleOptions).addTo(map);var northWest=L.latLng(-4.904886794837085,-43.18674087524414),southEast=L.latLng(-5.332669664718695,-42.37615585327149),bounds=L.latLngBounds(northWest,southEast);map.setMaxBounds(bounds),$.getJSON("data.geojson",function(data){L.geoJson(data,{pointToLayer:function(feature,latlng){return L.marker(latlng,{icon:iconMarkers[feature.properties.current_tipo],title:feature.properties.nome})},onEachFeature:bindPopup});document.getElementById("totalComercios").innerHTML="("+comerciosTotal+")",document.getElementById("totalFeiras").innerHTML="("+feirasTotal+")",document.getElementById("totalProdutores").innerHTML="("+produtoresTotal+")",produtoresLayerToControl.addTo(map),feirasLayerToControl.addTo(map),comercioLayerToControl.addTo(map),markersCluster.addTo(map)});var bindPopup=function(feature,layer){var properties=feature.properties,description="";feature.layer=layer,description="<div><strong> "+properties.nome+" </strong></div>",layer.bindPopup(description),layer.on({mouseover:function(){return layer.setIcon(iconMarkers[properties.current_tipo+"Selected"])},mouseout:function(){return layer.setIcon(iconMarkers[properties.current_tipo])}}),addLayerByType[properties.current_tipo](layer)},markersCluster=L.markerClusterGroup({disableClusteringAtZoom:13,showCoverageOnHover:!0,spiderfyOnMaxZoom:!1}),addLayerByType={Comercio:function(layer){comercioLayer.addLayer(layer),comerciosTotal++},Feira:function(layer){feirasLayer.addLayer(layer),feirasTotal++},Produtor:function(layer){produtoresLayer.addLayer(layer),produtoresTotal++}},sycronizeListMarkers=function(){var linePoint="",markerNames=sortList(markersCluster);document.getElementById("list-markers").innerHTML="";var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=markerNames[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){linePoint+='<li class="list-group-item list-group-item-action">'+_step.value+"</li>"}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}$("#list-markers").append(linePoint),updateEventsOnMarkers()},updateEventsOnMarkers=function(){var nome=null;$("#list-markers li").click(function(e){nome=$(e.currentTarget).text(),moveToPoint(markersCluster,nome)}),$("#list-markers li").hover(function(e){nome=$(e.currentTarget).text(),markersCluster.eachLayer(function(layer){layer.feature.properties.nome===nome&&layer.setIcon(iconMarkers[layer.feature.properties.current_tipo+"Selected"])})},function(){markersCluster.eachLayer(function(layer){layer.feature.properties.nome===nome&&layer.setIcon(iconMarkers[layer.feature.properties.current_tipo])})})};map.on("layeradd ",function(e){var layerName=stringLayerName(e.layer);layerName&&addRemoveLayerOfCluster[layerName](!0)}),map.on("layerremove",function(e){var layerName=stringLayerName(e.layer);layerName&&addRemoveLayerOfCluster[layerName](!1)});var addRemoveLayerOfCluster={comercioLayerToControl:function(isToAdd){isToAdd?markersCluster.addLayer(comercioLayer):markersCluster.removeLayer(comercioLayer),sycronizeListMarkers()},feirasLayerToControl:function(isToAdd){isToAdd?markersCluster.addLayer(feirasLayer):markersCluster.removeLayer(feirasLayer),sycronizeListMarkers()},produtoresLayerToControl:function(isToAdd){isToAdd?markersCluster.addLayer(produtoresLayer):markersCluster.removeLayer(produtoresLayer),sycronizeListMarkers()}},stringLayerName=function(layer){return layer===comercioLayerToControl?"comercioLayerToControl":layer===feirasLayerToControl?"feirasLayerToControl":layer===produtoresLayerToControl?"produtoresLayerToControl":""};$("#switch-produtor").on("change",function(e){return $(e.currentTarget).is(":checked")?map.addLayer(produtoresLayerToControl):map.removeLayer(produtoresLayerToControl)}),$("#switch-comercio").on("change",function(e){return $(e.currentTarget).is(":checked")?map.addLayer(comercioLayerToControl):map.removeLayer(comercioLayerToControl)}),$("#switch-feira").on("change",function(e){return $(e.currentTarget).is(":checked")?map.addLayer(feirasLayerToControl):map.removeLayer(feirasLayerToControl)}),$("#search-input").keyup(function(){var searchField=$("#search-input").val(),regex=new RegExp(searchField,"i"),listSearch="",propertiesFound=[];searchField?(markersCluster.eachLayer(function(layer){-1!=layer.feature.properties.nome.search(regex)&&searchField&&propertiesFound.length<5&&propertiesFound.push(layer.feature.properties.nome)}),propertiesFound.sort(),propertiesFound.forEach(function(element,index){listSearch+='<li class="list-group-item link-class"> '+element+" </li>"}),document.getElementById("search-results").innerHTML=listSearch,propertiesFound.length=0):document.getElementById("search-results").innerHTML=""}),$("#search-results").on("click","li",function(e){var inputValue=$(e.currentTarget).text().trim();$("#search-input").val(inputValue),moveToPoint(markersCluster,inputValue),document.getElementById("search-results").innerHTML=""});var moveToPoint=function(layerToSearch,name){var controle=!0,latlng=void 0;layerToSearch.eachLayer(function(layer){layer.feature.properties.nome===name&&(latlng=L.latLng(layer.feature.geometry.coordinates[1],layer.feature.geometry.coordinates[0]),map.flyTo(latlng,14),map.on("zoomend",function(){controle&&(openPopUp(name),controle=!1)}))})},openPopUp=function(name){var desc="";markersCluster.eachLayer(function(layer){layer.feature.properties.nome===name&&(desc="<div><strong>"+name+"</strong><br/><br/></div>",layer.bindPopup(desc).openPopup())})},sortList=function(layerToSort){var arrayTemp=[];return layerToSort.eachLayer(function(layer){arrayTemp.push(layer.feature.properties.nome)}),arrayTemp.sort()};